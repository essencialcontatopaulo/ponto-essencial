<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel do Gestor - Essencial Print</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/style.css">
    
    <!-- Scripts -->
    <script src="js/firebase-config.js"></script>
    <script src="js/gestor.js" defer></script>
    
    <style>
        /* ESTILOS ESPEC√çFICOS DO GESTOR (adicione ao seu style.css depois) */
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-presente {
            background: #d4edda;
            color: #155724;
        }

        .status-atrasado {
            background: #fff3cd;
            color: #856404;
        }

        .status-falta {
            background: #f8d7da;
            color: #721c24;
        }

        .status-inativo {
            background: #e9ecef;
            color: #495057;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: #1a237e;
            margin: 0;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .tab-navigation {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e8eaf6;
        }

        .tab-btn {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
        }

        .tab-btn.active {
            color: #1a237e;
            border-bottom: 3px solid #1a237e;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <h1>Essencial<span>Print</span></h1>
            </div>
            <div class="user-info">
                <h3 id="userName">Gestor</h3>
                <p id="userCargo">Painel Administrativo</p>
                <button class="btn-logout" onclick="logout()">Sair</button>
            </div>
        </header>

        <div class="dashboard">
            <!-- Estat√≠sticas -->
            <div class="card">
                <h2>üìä Estat√≠sticas Gerais</h2>
                <div class="stats-grid" id="statsGrid">
                    <div class="stat-card">
                        <div class="stat-number">0</div>
                        <div class="stat-label">Funcion√°rios</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">0</div>
                        <div class="stat-label">Registros Hoje</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">0</div>
                        <div class="stat-label">Pendentes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">0</div>
                        <div class="stat-label">Atrasos/M√™s</div>
                    </div>
                </div>
            </div>

            <!-- Funcion√°rios Ativos -->
            <div class="card">
                <h2>üë• Funcion√°rios 
                    <button class="btn btn-success" onclick="openModal('novoFuncionario')">+ Novo</button>
                    <button class="btn btn-primary" onclick="carregarFuncionarios()" title="Atualizar">‚Üª</button>
                </h2>
                <div class="search-box">
                    <input type="text" id="searchFuncionarios" placeholder="Buscar funcion√°rio..." onkeyup="filtrarFuncionarios()">
                </div>
                <div style="max-height: 400px; overflow-y: auto;">
                    <table id="tabelaFuncionarios">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Email</th>
                                <th>Cargo</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td colspan="5" style="text-align: center;">Carregando funcion√°rios...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Ajuste de Horas -->
            <div class="card">
                <h2>‚è∞ Ajuste de Horas 
                    <button class="btn btn-primary" onclick="openModal('ajusteHoras')">
                        <span>+</span> Novo Ajuste
                    </button>
                </h2>
                <p style="color: #666; margin-bottom: 15px;">Ajuste horas trabalhadas externamente</p>
                
                <div style="background: #f0f8ff; padding: 15px; border-radius: 10px;">
                    <h4 style="color: #1a237e; margin-bottom: 10px;">üìã √öltimos Ajustes</h4>
                    <div style="max-height: 200px; overflow-y: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Funcion√°rio</th>
                                    <th>Data</th>
                                    <th>Horas</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="tabelaAjustes">
                                <tr><td colspan="4" style="text-align: center;">Carregando...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Registros do Dia -->
            <div class="card">
                <h2>üìÖ Registros de Hoje</h2>
                <div style="max-height: 400px; overflow-y: auto;">
                    <table id="tabelaRegistros">
                        <thead>
                            <tr>
                                <th>Funcion√°rio</th>
                                <th>Hor√°rio</th>
                                <th>Tipo</th>
                                <th>Localiza√ß√£o</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td colspan="4" style="text-align: center;">Carregando registros...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Relat√≥rios -->
        <div class="card" style="margin-bottom: 25px;">
            <h2>üìà Relat√≥rios</h2>
            <div class="tab-navigation">
                <button class="tab-btn active" onclick="openTab('relatorioMensal')">Mensal</button>
                <button class="tab-btn" onclick="openTab('relatorioFuncionario')">Por Funcion√°rio</button>
                <button class="tab-btn" onclick="openTab('relatorioAjustes')">Ajustes</button>
            </div>
            
            <div id="relatorioMensal" class="tab-content active">
                <div class="form-group">
                    <label for="mesRelatorio">M√™s:</label>
                    <input type="month" id="mesRelatorio" class="form-control" onchange="gerarRelatorioMensal()">
                </div>
                <div id="relatorioMensalContent">
                    <p style="color: #666;">Selecione um m√™s para gerar o relat√≥rio</p>
                </div>
            </div>
            
            <div id="relatorioFuncionario" class="tab-content">
                <div class="form-group">
                    <label for="funcionarioRelatorio">Funcion√°rio:</label>
                    <select id="funcionarioRelatorio" class="form-control" onchange="gerarRelatorioFuncionario()">
                        <option value="">Selecione um funcion√°rio</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="periodoRelatorio">Per√≠odo:</label>
                    <input type="month" id="periodoRelatorio" class="form-control" onchange="gerarRelatorioFuncionario()">
                </div>
                <div id="relatorioFuncionarioContent">
                    <p style="color: #666;">Selecione um funcion√°rio e per√≠odo</p>
                </div>
            </div>
            
            <div id="relatorioAjustes" class="tab-content">
                <div class="form-group">
                    <label for="periodoAjustes">Per√≠odo:</label>
                    <input type="month" id="periodoAjustes" class="form-control" onchange="gerarRelatorioAjustes()">
                </div>
                <div id="relatorioAjustesContent">
                    <p style="color: #666;">Selecione um per√≠odo para ver os ajustes</p>
                </div>
            </div>
        </div>

        <footer>
            <p>Essencial Print &copy; 2024 - Painel Administrativo</p>
            <p>Acesso restrito a gestores autorizados</p>
        </footer>
    </div>

    <!-- MODAL NOVO FUNCION√ÅRIO -->
    <div id="modalNovoFuncionario" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ûï Cadastrar Novo Funcion√°rio</h3>
                <button class="close-modal" onclick="closeModal('novoFuncionario')">√ó</button>
            </div>
            <form id="formNovoFuncionario" onsubmit="return false;">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="nomeFuncionario">Nome Completo *</label>
                        <input type="text" id="nomeFuncionario" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="emailFuncionario">E-mail *</label>
                        <input type="email" id="emailFuncionario" class="form-control" required>
                    </div>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="senhaFuncionario">Senha *</label>
                        <input type="password" id="senhaFuncionario" class="form-control" required>
                        <small style="color: #666; font-size: 12px;">M√≠nimo 6 caracteres</small>
                    </div>
                    <div class="form-group">
                        <label for="cpfFuncionario">CPF *</label>
                        <input type="text" id="cpfFuncionario" class="form-control" placeholder="000.000.000-00" required>
                    </div>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="cargoFuncionario">Cargo *</label>
                        <select id="cargoFuncionario" class="form-control" required>
                            <option value="">Selecione...</option>
                            <option value="Operador">Operador</option>
                            <option value="Designer">Designer</option>
                            <option value="Atendente">Atendente</option>
                            <option value="Auxiliar">Auxiliar</option>
                            <option value="Supervisor">Supervisor</option>
                            <option value="Gerente">Gerente</option>
                            <option value="Outro">Outro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="departamentoFuncionario">Departamento *</label>
                        <select id="departamentoFuncionario" class="form-control" required>
                            <option value="">Selecione...</option>
                            <option value="Produ√ß√£o">Produ√ß√£o</option>
                            <option value="Atendimento">Atendimento</option>
                            <option value="Design">Design</option>
                            <option value="Administra√ß√£o">Administra√ß√£o</option>
                            <option value="RH">RH</option>
                            <option value="Financeiro">Financeiro</option>
                            <option value="Comercial">Comercial</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="salarioFuncionario">Sal√°rio (R$)</label>
                        <input type="number" id="salarioFuncionario" class="form-control" step="0.01" placeholder="0,00">
                    </div>
                    <div class="form-group">
                        <label for="dataAdmissao">Data de Admiss√£o *</label>
                        <input type="date" id="dataAdmissao" class="form-control" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="telefoneFuncionario">Telefone</label>
                    <input type="text" id="telefoneFuncionario" class="form-control" placeholder="(11) 99999-9999">
                </div>
                
                <div class="form-group">
                    <label for="enderecoFuncionario">Endere√ßo</label>
                    <textarea id="enderecoFuncionario" class="form-control" rows="2" placeholder="Rua, N√∫mero, Bairro, Cidade"></textarea>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="button" class="btn btn-success" onclick="cadastrarFuncionario()" style="flex: 1;">
                        ‚úì Cadastrar
                    </button>
                    <button type="button" class="btn btn-danger" onclick="closeModal('novoFuncionario')" style="flex: 1;">
                        √ó Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL AJUSTE DE HORAS -->
    <div id="modalAjusteHoras" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚è∞ Ajuste de Horas Trabalhadas</h3>
                <button class="close-modal" onclick="closeModal('ajusteHoras')">√ó</button>
            </div>
            <form id="formAjusteHoras" onsubmit="return false;">
                <div class="form-group">
                    <label for="funcionarioAjuste">Funcion√°rio *</label>
                    <select id="funcionarioAjuste" class="form-control" required onchange="carregarHorarioAtual()">
                        <option value="">Selecione um funcion√°rio</option>
                    </select>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="dataAjuste">Data *</label>
                        <input type="date" id="dataAjuste" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="tipoAjuste">Tipo de Ajuste *</label>
                        <select id="tipoAjuste" class="form-control" required>
                            <option value="">Selecione...</option>
                            <option value="trabalho_externo">Trabalho Externo</option>
                            <option value="hora_extra">Hora Extra</option>
                            <option value="falta_justificada">Falta Justificada</option>
                            <option value="atraso_justificado">Atraso Justificado</option>
                            <option value="compensacao">Compensa√ß√£o de Horas</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="horaEntradaAjuste">Hora de Entrada *</label>
                        <input type="time" id="horaEntradaAjuste" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="horaSaidaAjuste">Hora de Sa√≠da *</label>
                        <input type="time" id="horaSaidaAjuste" class="form-control" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="totalHorasAjuste">Total de Horas</label>
                    <input type="text" id="totalHorasAjuste" class="form-control" readonly style="background: #f5f5f5;">
                    <small style="color: #666; font-size: 12px;">Calculado automaticamente</small>
                </div>
                
                <div class="form-group">
                    <label for="justificativaAjuste">Justificativa *</label>
                    <textarea id="justificativaAjuste" class="form-control" rows="3" 
                              placeholder="Descreva o motivo do ajuste (ex: Trabalho externo sem acesso √† internet)" required></textarea>
                </div>
                
                <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <h4 style="color: #2e7d32; margin-bottom: 10px;">üìã Hor√°rios Registrados para esta data:</h4>
                    <div id="horariosExistentes">
                        <p style="color: #666;">Selecione um funcion√°rio e data para ver os hor√°rios</p>
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="button" class="btn btn-success" onclick="salvarAjusteHoras()" style="flex: 1;">
                        üíæ Salvar Ajuste
                    </button>
                    <button type="button" class="btn btn-primary" onclick="calcularHoras()" style="flex: 1;">
                        üßÆ Calcular Horas
                    </button>
                    <button type="button" class="btn btn-danger" onclick="closeModal('ajusteHoras')" style="flex: 1;">
                        √ó Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL EDITAR FUNCION√ÅRIO -->
    <div id="modalEditarFuncionario" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚úèÔ∏è Editar Funcion√°rio</h3>
                <button class="close-modal" onclick="closeModal('editarFuncionario')">√ó</button>
            </div>
            <form id="formEditarFuncionario" onsubmit="return false;">
                <input type="hidden" id="editarFuncionarioId">
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="editarNome">Nome Completo *</label>
                        <input type="text" id="editarNome" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="editarEmail">E-mail *</label>
                        <input type="email" id="editarEmail" class="form-control" required>
                    </div>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="editarCpf">CPF *</label>
                        <input type="text" id="editarCpf" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="editarCargo">Cargo *</label>
                        <input type="text" id="editarCargo" class="form-control" required>
                    </div>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="editarDepartamento">Departamento *</label>
                        <input type="text" id="editarDepartamento" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <div style="display: flex; gap: 15px; margin-top: 8px;">
                            <label>
                                <input type="radio" name="editarStatus" value="ativo" checked> Ativo
                            </label>
                            <label>
                                <input type="radio" name="editarStatus" value="inativo"> Inativo
                            </label>
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="button" class="btn btn-success" onclick="atualizarFuncionario()" style="flex: 1;">
                        üíæ Salvar Altera√ß√µes
                    </button>
                    <button type="button" class="btn btn-danger" onclick="closeModal('editarFuncionario')" style="flex: 1;">
                        √ó Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Inicializa√ß√£o b√°sica
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar data atual nos inputs
            const hoje = new Date().toISOString().split('T')[0];
            const mesAtual = new Date().toISOString().slice(0, 7);
            
            if (document.getElementById('mesRelatorio')) {
                document.getElementById('mesRelatorio').value = mesAtual;
                document.getElementById('periodoRelatorio').value = mesAtual;
                document.getElementById('periodoAjustes').value = mesAtual;
            }
            
            if (document.getElementById('dataAdmissao')) {
                document.getElementById('dataAdmissao').value = hoje;
            }
            
            if (document.getElementById('dataAjuste')) {
                document.getElementById('dataAjuste').value = hoje;
            }
            
            // Configurar c√°lculo autom√°tico de horas
            const entradaInput = document.getElementById('horaEntradaAjuste');
            const saidaInput = document.getElementById('horaSaidaAjuste');
            
            if (entradaInput && saidaInput) {
                entradaInput.addEventListener('change', calcularHoras);
                saidaInput.addEventListener('change', calcularHoras);
            }
        });

        // Fun√ß√µes auxiliares de interface
        function openModal(modalName) {
            const modalElement = document.getElementById(`modal${modalName.charAt(0).toUpperCase() + modalName.slice(1)}`);
            if (modalElement) {
                modalElement.style.display = 'flex';
                
                // Carregar dados se for modal de ajuste
                if (modalName === 'ajusteHoras') {
                    carregarFuncionariosParaAjuste();
                }
            }
        }

        function closeModal(modalName) {
            const modalElement = document.getElementById(`modal${modalName.charAt(0).toUpperCase() + modalName.slice(1)}`);
            if (modalElement) {
                modalElement.style.display = 'none';
                
                // Limpar formul√°rios
                if (modalName === 'novoFuncionario') {
                    document.getElementById('formNovoFuncionario').reset();
                }
                if (modalName === 'ajusteHoras') {
                    document.getElementById('formAjusteHoras').reset();
                    document.getElementById('horariosExistentes').innerHTML = 
                        '<p style="color: #666;">Selecione um funcion√°rio e data para ver os hor√°rios</p>';
                }
            }
        }

        function openTab(tabName) {
            // Esconder todas as tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Mostrar tab selecionada
            const tabElement = document.getElementById(tabName);
            if (tabElement) {
                tabElement.classList.add('active');
            }
            if (event && event.target) {
                event.target.classList.add('active');
            }
        }

        function calcularHoras() {
            const entrada = document.getElementById('horaEntradaAjuste')?.value;
            const saida = document.getElementById('horaSaidaAjuste')?.value;
            
            if (!entrada || !saida) {
                if (document.getElementById('totalHorasAjuste')) {
                    document.getElementById('totalHorasAjuste').value = '';
                }
                return;
            }
            
            // Converter para objetos Date
            const [h1, m1] = entrada.split(':').map(Number);
            const [h2, m2] = saida.split(':').map(Number);
            
            const entradaDate = new Date(0, 0, 0, h1, m1);
            const saidaDate = new Date(0, 0, 0, h2, m2);
            
            // Calcular diferen√ßa
            const diffMs = saidaDate - entradaDate;
            const diffMinutes = Math.floor(diffMs / 60000);
            
            const horas = Math.floor(diffMinutes / 60);
            const minutos = diffMinutes % 60;
            
            if (document.getElementById('totalHorasAjuste')) {
                document.getElementById('totalHorasAjuste').value = `${horas}:${minutos.toString().padStart(2, '0')}`;
            }
        }

        function filtrarFuncionarios() {
            const input = document.getElementById('searchFuncionarios')?.value.toLowerCase() || '';
            const rows = document.querySelectorAll('#tabelaFuncionarios tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(input) ? '' : 'none';
            });
        }

        function logout() {
            if (confirm('Deseja realmente sair?')) {
                // A fun√ß√£o logout() ser√° implementada no gestor.js
                window.location.href = 'index.html';
            }
        }
    </script>
</body>
</html>
