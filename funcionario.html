<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√Årea do Funcion√°rio - Essencial Print</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        /* Mesmo CSS anterior do funcionario (mantenha todo o CSS) */
    </style>
</head>
<body>
    <!-- Verifica√ß√£o com Firebase -->
    <script>
        // CONFIGURA√á√ÉO DO FIREBASE
        const firebaseConfig = {
    apiKey: "AIzaSyB...",
    authDomain: "essencial-print.firebaseapp.com",
    projectId: "essencial-print",
    storageBucket: "essencial-print.appspot.com",
    messagingSenderId: "123456789",
    appId: "1:123456789:web:abcdef123456"
};
        
        // Inicializar Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();
            
            // Verificar se funcion√°rio est√° logado
            const funcionario = JSON.parse(localStorage.getItem('funcionario_logado') || 'null');
            
            if (!funcionario) {
                alert('Acesso n√£o autorizado! Fa√ßa login primeiro.');
                window.location.href = 'index.html';
                return;
            }
            
            // Configurar dados do usu√°rio
            document.getElementById('userName').textContent = funcionario.nome;
            document.getElementById('userCargo').textContent = `${funcionario.cargo} - ${funcionario.departamento}`;
            
            // Carregar dados
            carregarRegistrosHoje();
            atualizarStatus();
            
        } catch (error) {
            console.error('Erro ao inicializar Firebase:', error);
            // Fallback para modo local
        }
        
        // Registrar ponto com Firebase
        async function registrarPonto(tipo) {
            try {
                const funcionario = JSON.parse(localStorage.getItem('funcionario_logado'));
                const agora = new Date();
                const data = agora.toISOString().split('T')[0];
                const horario = agora.toLocaleTimeString('pt-BR', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    second: '2-digit'
                });
                
                // Obter localiza√ß√£o
                let localizacao = { latitude: null, longitude: null };
                
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        position => {
                            localizacao = {
                                latitude: position.coords.latitude,
                                longitude: position.coords.longitude
                            };
                        },
                        error => {
                            console.log('Erro ao obter localiza√ß√£o:', error);
                        }
                    );
                }
                
                // Criar registro no Firestore
                await db.collection('pontos').add({
                    funcionarioId: funcionario.id,
                    funcionarioNome: funcionario.nome,
                    funcionarioCpf: funcionario.cpf,
                    tipo: tipo,
                    data: data,
                    horario: horario,
                    localizacao: localizacao,
                    timestamp: agora.getTime(),
                    createdAt: new Date().toISOString()
                });
                
                alert(`‚úÖ ${tipo === 'entrada' ? 'ENTRADA' : 'SA√çDA'} registrada com sucesso!`);
                
                // Atualizar interface
                carregarRegistrosHoje();
                atualizarStatus();
                
            } catch (error) {
                console.error('Erro ao registrar ponto:', error);
                alert('Erro ao registrar ponto. Tente novamente.');
            }
        }
        
        // Carregar registros do dia do Firestore
        async function carregarRegistrosHoje() {
            try {
                const funcionario = JSON.parse(localStorage.getItem('funcionario_logado'));
                const hoje = new Date().toISOString().split('T')[0];
                
                const snapshot = await db.collection('pontos')
                    .where('funcionarioId', '==', funcionario.id)
                    .where('data', '==', hoje)
                    .orderBy('timestamp', 'desc')
                    .get();
                
                const tbody = document.querySelector('#registrosHoje tbody');
                
                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="3" style="text-align: center;">Nenhum registro hoje</td></tr>';
                    return;
                }
                
                let html = '';
                snapshot.forEach(doc => {
                    const registro = doc.data();
                    html += `
                        <tr>
                            <td>${registro.horario}</td>
                            <td>${registro.tipo === 'entrada' ? 'Entrada' : 'Sa√≠da'}</td>
                            <td>${registro.localizacao.latitude ? 'üìç Registrada' : '--'}</td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
                
            } catch (error) {
                console.error('Erro ao carregar registros:', error);
            }
        }
        
        // Enviar justificativa para Firestore
        async function enviarJustificativa() {
            try {
                const funcionario = JSON.parse(localStorage.getItem('funcionario_logado'));
                const tipo = document.getElementById('tipoJustificativa').value;
                const data = document.getElementById('dataJustificativa').value;
                const descricao = document.getElementById('descricaoJustificativa').value.trim();
                
                if (!tipo || !descricao) {
                    alert('Preencha todos os campos!');
                    return;
                }
                
                await db.collection('justificativas').add({
                    funcionarioId: funcionario.id,
                    funcionarioNome: funcionario.nome,
                    tipo: tipo,
                    data: data,
                    descricao: descricao,
                    status: 'pendente',
                    dataEnvio: new Date().toISOString()
                });
                
                alert('Justificativa enviada com sucesso! Aguarde aprova√ß√£o.');
                document.getElementById('descricaoJustificativa').value = '';
                carregarMinhasJustificativas();
                
            } catch (error) {
                console.error('Erro ao enviar justificativa:', error);
                alert('Erro ao enviar justificativa!');
            }
        }
    </script>

    <!-- Resto do HTML igual ao anterior -->
    <!-- (Mantenha todo o HTML da vers√£o anterior do funcionario.html) -->
</body>
</html>
