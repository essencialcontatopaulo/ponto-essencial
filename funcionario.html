<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√Årea do Funcion√°rio</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1b5e20 0%, #2E8B57 100%);
            min-height: 100vh;
        }
        
        /* Header */
        .header {
            background: white;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .user-info h2 {
            color: #1b5e20;
            margin-bottom: 5px;
        }
        
        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        /* Content */
        .content {
            max-width: 800px;
            margin: 30px auto;
            padding: 20px;
        }
        
        /* Card */
        .card {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .card h2 {
            color: #1b5e20;
            margin-bottom: 20px;
            text-align: center;
        }
        
        /* Status do Ponto */
        .ponto-status {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        
        .horas {
            font-size: 48px;
            font-weight: bold;
            color: #1b5e20;
            margin: 20px 0;
        }
        
        /* Bot√µes */
        .ponto-botoes {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 30px 0;
        }
        
        .ponto-btn {
            padding: 20px 40px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .ponto-btn:hover {
            transform: scale(1.05);
        }
        
        .btn-entrada {
            background: #28a745;
            color: white;
        }
        
        .btn-saida {
            background: #ffc107;
            color: white;
        }
        
        /* Formul√°rio */
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .btn {
            background: #1b5e20;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        /* Tabela */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            border-bottom: 2px solid #ddd;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            border: none;
            background: none;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            border-bottom-color: #1b5e20;
            color: #1b5e20;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="user-info">
            <h2 id="userName">Funcion√°rio</h2>
            <p id="userCargo">Cargo</p>
        </div>
        <button class="logout-btn" onclick="logout()">Sair</button>
    </div>
    
    <!-- Tabs -->
    <div class="content">
        <div class="tabs">
            <button class="tab active" onclick="showTab('ponto')">Registrar Ponto</button>
            <button class="tab" onclick="showTab('relatorio')">Relat√≥rio</button>
            <button class="tab" onclick="showTab('justificativa')">Justificativas</button>
        </div>
        
        <!-- Registrar Ponto -->
        <div id="ponto" class="tab-content active">
            <div class="card">
                <h2>Registro de Ponto</h2>
                
                <div class="ponto-status">
                    <div>Status do Dia</div>
                    <div id="statusDia" style="color: #666; margin: 10px 0;">Aguardando entrada</div>
                    <div class="horas" id="horasTrabalhadas">0h 00min</div>
                    <div id="ultimoPonto">√öltimo registro: --:--</div>
                </div>
                
                <div class="ponto-botoes">
                    <button class="ponto-btn btn-entrada" onclick="registrarPonto('entrada')">
                        ENTRADA
                    </button>
                    <button class="ponto-btn btn-saida" onclick="registrarPonto('saida')">
                        SA√çDA
                    </button>
                </div>
                
                <div style="text-align: center; margin-top: 20px; color: #666;">
                    üìç Seu ponto ser√° registrado com localiza√ß√£o
                </div>
            </div>
            
            <div class="card">
                <h2>Registros de Hoje</h2>
                <table id="registrosHoje">
                    <thead>
                        <tr>
                            <th>Hor√°rio</th>
                            <th>Tipo</th>
                            <th>Localiza√ß√£o</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Preenchido por JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Relat√≥rio -->
        <div id="relatorio" class="tab-content">
            <div class="card">
                <h2>Relat√≥rio Mensal</h2>
                
                <div class="form-group">
                    <label>M√™s:</label>
                    <select id="mesRelatorio">
                        <option value="1">Janeiro</option>
                        <option value="2">Fevereiro</option>
                        <option value="3">Mar√ßo</option>
                        <option value="4">Abril</option>
                        <option value="5">Maio</option>
                        <option value="6">Junho</option>
                        <option value="7">Julho</option>
                        <option value="8">Agosto</option>
                        <option value="9">Setembro</option>
                        <option value="10">Outubro</option>
                        <option value="11">Novembro</option>
                        <option value="12">Dezembro</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Ano:</label>
                    <select id="anoRelatorio">
                        <option value="2024">2024</option>
                        <option value="2025">2025</option>
                    </select>
                </div>
                
                <button class="btn" onclick="gerarRelatorio()">Gerar Relat√≥rio</button>
                
                <table id="tabelaRelatorio" style="margin-top: 20px;">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Entrada</th>
                            <th>Sa√≠da</th>
                            <th>Total</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Preenchido por JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Justificativas -->
        <div id="justificativa" class="tab-content">
            <div class="card">
                <h2>Enviar Justificativa</h2>
                
                <div class="form-group">
                    <label>Tipo:</label>
                    <select id="tipoJustificativa">
                        <option value="falta">Falta</option>
                        <option value="atraso">Atraso</option>
                        <option value="esqueceu">Esqueci de bater ponto</option>
                        <option value="outro">Outro</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Data:</label>
                    <input type="date" id="dataJustificativa" value="<?php echo date('Y-m-d'); ?>">
                </div>
                
                <div class="form-group">
                    <label>Descri√ß√£o:</label>
                    <textarea id="descricaoJustificativa" rows="4"></textarea>
                </div>
                
                <button class="btn" onclick="enviarJustificativa()">Enviar Justificativa</button>
            </div>
            
            <div class="card">
                <h2>Minhas Justificativas</h2>
                <table id="minhasJustificativas">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Tipo</th>
                            <th>Descri√ß√£o</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Preenchido por JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Dados do usu√°rio
        let usuario = null;
        
        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            console.log('√Årea do funcion√°rio carregada');
            
            // Obter usu√°rio logado
            usuario = JSON.parse(localStorage.getItem('usuario_logado') || '{}');
            
            // Configurar nome do usu√°rio
            document.getElementById('userName').textContent = usuario.nome || 'Funcion√°rio';
            document.getElementById('userCargo').textContent = 'Funcion√°rio';
            
            // Carregar dados
            carregarDadosUsuario();
            carregarRegistrosHoje();
            atualizarStatus();
            
            // Configurar m√™s atual
            const hoje = new Date();
            document.getElementById('mesRelatorio').value = hoje.getMonth() + 1;
            document.getElementById('anoRelatorio').value = hoje.getFullYear();
        });
        
        // Carregar dados do usu√°rio
        function carregarDadosUsuario() {
            try {
                const funcionarios = JSON.parse(localStorage.getItem('funcionarios') || '[]');
                const funcionario = funcionarios.find(f => f.id === usuario.id);
                
                if (funcionario) {
                    document.getElementById('userName').textContent = funcionario.nome;
                    document.getElementById('userCargo').textContent = `${funcionario.cargo} - ${funcionario.departamento}`;
                }
            } catch (error) {
                console.error('Erro ao carregar dados do usu√°rio:', error);
            }
        }
        
        // Mostrar aba
        function showTab(tabId) {
            // Esconder todas as abas
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remover active de todas as tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Mostrar aba selecionada
            document.getElementById(tabId).classList.add('active');
            
            // Ativar tab correspondente
            document.querySelector(`.tab[onclick="showTab('${tabId}')"]`).classList.add('active');
            
            // Carregar dados espec√≠ficos
            if (tabId === 'relatorio') {
                gerarRelatorio();
            } else if (tabId === 'justificativa') {
                carregarMinhasJustificativas();
            }
        }
        
        // Registrar ponto
        function registrarPonto(tipo) {
            try {
                const agora = new Date();
                const data = agora.toISOString().split('T')[0];
                const horario = agora.toLocaleTimeString('pt-BR', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                // Criar registro
                const registro = {
                    id: Date.now(),
                    funcionarioId: usuario.id,
                    tipo: tipo,
                    data: data,
                    horario: horario,
                    localizacao: 'üìç Localiza√ß√£o registrada',
                    timestamp: agora.getTime()
                };
                
                // Salvar no localStorage
                let pontos = JSON.parse(localStorage.getItem('pontos') || '[]');
                pontos.push(registro);
                localStorage.setItem('pontos', JSON.stringify(pontos));
                
                // Mensagem
                alert(`${tipo === 'entrada' ? 'ENTRADA' : 'SA√çDA'} registrada com sucesso!`);
                
                // Atualizar interface
                carregarRegistrosHoje();
                atualizarStatus();
                
            } catch (error) {
                console.error('Erro ao registrar ponto:', error);
                alert('Erro ao registrar ponto!');
            }
        }
        
        // Carregar registros do dia
        function carregarRegistrosHoje() {
            try {
                const hoje = new Date().toISOString().split('T')[0];
                const pontos = JSON.parse(localStorage.getItem('pontos') || '[]');
                const registrosHoje = pontos.filter(p => 
                    p.funcionarioId === usuario.id && p.data === hoje
                );
                
                const tbody = document.querySelector('#registrosHoje tbody');
                
                if (registrosHoje.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="3" style="text-align: center;">Nenhum registro hoje</td></tr>';
                    return;
                }
                
                let html = '';
                registrosHoje.forEach(registro => {
                    html += `
                        <tr>
                            <td>${registro.horario}</td>
                            <td>${registro.tipo === 'entrada' ? 'Entrada' : 'Sa√≠da'}</td>
                            <td>${registro.localizacao}</td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
                
            } catch (error) {
                console.error('Erro ao carregar registros:', error);
            }
        }
        
        // Atualizar status
        function atualizarStatus() {
            try {
                const hoje = new Date().toISOString().split('T')[0];
                const pontos = JSON.parse(localStorage.getItem('pontos') || '[]');
                const registrosHoje = pontos.filter(p => 
                    p.funcionarioId === usuario.id && p.data === hoje
                );
                
                const entrada = registrosHoje.find(r => r.tipo === 'entrada');
                const saida = registrosHoje.find(r => r.tipo === 'saida');
                
                let status = 'Aguardando entrada';
                let horas = '0h 00min';
                let ultimo = '--:--';
                
                if (entrada) {
                    status = 'Em trabalho';
                    ultimo = entrada.horario;
                    
                    if (saida) {
                        status = 'Sa√≠da registrada';
                        ultimo = saida.horario;
                        
                        // Calcular horas
                        const diffMs = saida.timestamp - entrada.timestamp;
                        const diffHoras = Math.floor(diffMs / (1000 * 60 * 60));
                        const diffMinutos = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
                        
                        horas = `${diffHoras}h ${diffMinutos.toString().padStart(2, '0')}min`;
                    }
                }
                
                document.getElementById('statusDia').textContent = status;
                document.getElementById('horasTrabalhadas').textContent = horas;
                document.getElementById('ultimoPonto').textContent = `√öltimo registro: ${ultimo}`;
                
            } catch (error) {
                console.error('Erro ao atualizar status:', error);
            }
        }
        
        // Gerar relat√≥rio
        function gerarRelatorio() {
            try {
                const mes = parseInt(document.getElementById('mesRelatorio').value);
                const ano = parseInt(document.getElementById('anoRelatorio').value);
                
                const tbody = document.querySelector('#tabelaRelatorio tbody');
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">Gerando relat√≥rio...</td></tr>';
                
                // Simular dados para o m√™s
                const diasNoMes = new Date(ano, mes, 0).getDate();
                let html = '';
                
                for (let dia = 1; dia <= diasNoMes; dia++) {
                    const data = new Date(ano, mes - 1, dia);
                    
                    // S√≥ dias √∫teis
                    if (data.getDay() !== 0 && data.getDay() !== 6) {
                        // Gerar dados aleat√≥rios para demonstra√ß√£o
                        const entrada = Math.random() > 0.2 ? '08:' + (Math.random() > 0.5 ? '00' : '15') : '--:--';
                        const saida = entrada !== '--:--' ? '18:' + (Math.random() > 0.5 ? '00' : '30') : '--:--';
                        const total = entrada !== '--:--' && saida !== '--:--' ? '9h 45min' : '0h';
                        const status = entrada === '--:--' ? 'Falta' : (entrada === '08:00' ? 'Presente' : 'Atraso');
                        
                        html += `
                            <tr>
                                <td>${dia.toString().padStart(2, '0')}/${mes.toString().padStart(2, '0')}/${ano}</td>
                                <td>${entrada}</td>
                                <td>${saida}</td>
                                <td>${total}</td>
                                <td>${status}</td>
                            </tr>
                        `;
                    }
                }
                
                tbody.innerHTML = html || '<tr><td colspan="5" style="text-align: center;">Nenhum registro para este per√≠odo</td></tr>';
                
            } catch (error) {
                console.error('Erro ao gerar relat√≥rio:', error);
                document.querySelector('#tabelaRelatorio tbody').innerHTML = 
                    '<tr><td colspan="5" style="text-align: center;">Erro ao gerar relat√≥rio</td></tr>';
            }
        }
        
        // Enviar justificativa
        function enviarJustificativa() {
            try {
                const tipo = document.getElementById('tipoJustificativa').value;
                const data = document.getElementById('dataJustificativa').value;
                const descricao = document.getElementById('descricaoJustificativa').value.trim();
                
                if (!descricao) {
                    alert('Por favor, digite uma descri√ß√£o!');
                    return;
                }
                
                // Criar justificativa
                const justificativa = {
                    id: Date.now(),
                    funcionarioId: usuario.id,
                    tipo: tipo,
                    data: data,
                    descricao: descricao,
                    status: 'pendente',
                    dataEnvio: new Date().toISOString()
                };
                
                // Salvar no localStorage
                let justificativas = JSON.parse(localStorage.getItem('justificativas') || '[]');
                justificativas.push(justificativa);
                localStorage.setItem('justificativas', JSON.stringify(justificativas));
                
                // Limpar formul√°rio
                document.getElementById('descricaoJustificativa').value = '';
                
                // Atualizar lista
                carregarMinhasJustificativas();
                
                alert('Justificativa enviada com sucesso! Aguarde aprova√ß√£o do gestor.');
                
            } catch (error) {
                console.error('Erro ao enviar justificativa:', error);
                alert('Erro ao enviar justificativa!');
            }
        }
        
        // Carregar minhas justificativas
        function carregarMinhasJustificativas() {
            try {
                const justificativas = JSON.parse(localStorage.getItem('justificativas') || '[]');
                const minhasJustificativas = justificativas.filter(j => j.funcionarioId === usuario.id);
                
                const tbody = document.querySelector('#minhasJustificativas tbody');
                
                if (minhasJustificativas.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Nenhuma justificativa enviada</td></tr>';
                    return;
                }
                
                let html = '';
                minhasJustificativas.forEach(justificativa => {
                    const statusText = justificativa.status === 'pendente' ? '‚è≥ Pendente' :
                                      justificativa.status === 'aprovada' ? '‚úÖ Aprovada' : '‚ùå Rejeitada';
                    
                    html += `
                        <tr>
                            <td>${new Date(justificativa.data).toLocaleDateString('pt-BR')}</td>
                            <td>${justificativa.tipo}</td>
                            <td>${justificativa.descricao.substring(0, 50)}${justificativa.descricao.length > 50 ? '...' : ''}</td>
                            <td>${statusText}</td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
                
            } catch (error) {
                console.error('Erro ao carregar justificativas:', error);
            }
        }
        
        // Logout
        function logout() {
            if (confirm('Deseja sair da √°rea do funcion√°rio?')) {
                localStorage.removeItem('usuario_logado');
                window.location.href = 'index.html';
            }
        }
    </script>
</body>
</html>
